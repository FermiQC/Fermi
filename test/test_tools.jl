@reset
@set printstyle none

# Psi4, water.xyz, sto-3g, h=0.005
findif_dict = Dict{String,Matrix}(
    "rhf" => [ 8.3320809540e-03  8.5752642345e-03  8.0196787273e-03
               4.2988604895e-03 -8.6636480390e-03 -8.1043008697e-03
              -1.2629991185e-02  8.7293603291e-05  8.3400495815e-05],
    "uhf" => [ 8.3320809435e-03  8.5752642337e-03  8.0196787311e-03
               4.2988605022e-03 -8.6636480435e-03 -8.1043008502e-03
              -1.2629991185e-02  8.7293597275e-05  8.3400494311e-05],
    "rmp2" => [ 0.0290246974  0.0299461327  0.0280108057
               -0.0186802117 -0.0128254568 -0.0119974135
               -0.010343374  -0.0171215596 -0.0160144154],
    "rccsd" => [ 0.0384959395  0.0397277184  0.0371608718
                -0.0315473952 -0.0135172429 -0.0126445367
                -0.0069474712 -0.0262114786 -0.0245174702],
    "rccsd(t)" => [ 0.0384823474  0.0397136832  0.0371477426
                   -0.0316042684 -0.0134773411 -0.012607211 
                   -0.0068769994 -0.0262373368 -0.0245416589]
)

@testset "Tools" begin

    # Finite differences gradients
    @testset "Findif" begin
        Fermi.Options.set("deriv_type", "findif")
        
        for i in eachindex(findif_dict)
            grad_str = "@gradient Fermi.Molecule() => $i"
            g = eval(Meta.parse(grad_str))
            Δg = g - findif_dict[i]
            @test √(sum(Δg.^2)/length(g)) < tol
        end
    end

end